#jinja2:lstrip_blocks: True, trim_blocks: True
---
# This NDFC policy and switch attachments config data structure is auto-generated
# DO NOT EDIT MANUALLY
#
{# {% set switches = MD_Extended.vxlan.policy.switches | community.general.json_query('[*].name') | flatten | unique | sort %} #}
- switch:
{% for switch in MD_Extended.vxlan.policy.switches %}
    - ip: {{ switch.name }}
      policies:
{% for group_entry in switch.groups %}
{% set query = "[?(@.name==`" ~ group_entry ~ "`)]" %}
{% set policy_group_match = MD_Extended.vxlan.policy.groups | community.general.json_query(query) | first %}
{% for policy in policy_group_match.policies %}
{% set query = "[?(@.name==`" ~ policy.name ~ "`)]" %}
{% set policy_match = MD_Extended.vxlan.policy.policies | community.general.json_query(query) | first %}
        - create_additional_policy: False
          description: {{ policy_match.name }}
          name: {{ policy_match.template_name | default(defaults.vxlan.policy.template_name) }}
          policy_vars:
            {% if policy_match.template_vars is defined and policy_match.template_vars %}
            {{ policy_match.template_vars | default(omit) | ansible.builtin.to_nice_yaml | trim }}
            {% elif policy_match.filename is defined and policy_match.filename %}
            {{ lookup('ansible.builtin.file', policy_match.filename) | trim | indent(14) }}
            {% endif %}
          priority: {{ policy.priority | default(policy_group_match.priority) | default(defaults.vxlan.policy.priority) }}
{% endfor %}
{% endfor %}
{% endfor %}
