! This NDFC VRF-Lite BGP config data structure is auto-generated
! DO NOT EDIT MANUALLY
!
!
vrf context {{ item.vrf }}
{% if switch_item.static_routes is defined and switch_item.static_routes %}
{% for static_route in switch_item.static_routes %}
{% for next_hop in static_route.next_hops %}
{% if static_route.route_tag is defined and static_route.route_tag %}
  ip route {{ static_route.prefix }} {{ next_hop.ip }} tag {{ static_route.route_tag }}
{% else %}
  ip route {{ static_route.prefix }} {{ next_hop.ip }}
{% endif %}
!
{% endfor %}
{% endfor %}
{% endif %}
router bgp {{ MD_Extended.vxlan.global.bgp_asn }}
  vrf {{ item.vrf }}
  {% if switch_item['router_id'] is defined and switch_item['router_id'] %}
    router-id {{ switch_item['router_id'] }}
  {% endif %}
  {% if switch_item.bgp.best_path_as_path_relax is defined and switch_item.bgp.best_path_as_path_relax %}
    bestpath as-path multipath-relax
  {% elif switch_item.bgp.best_path_as_path_relax is not defined and item.bgp.best_path_as_path_relax is defined and item.bgp.best_path_as_path_relax %}
    bestpath as-path multipath-relax
  {% endif %}
  {% if switch_item.bgp.graceful_restart is defined and switch_item.bgp.graceful_restart %}
    bestpath as-path multipath-relax
  {% elif switch_item.bgp.graceful_restart is not defined and item.bgp.graceful_restart is defined and item.bgp.graceful_restart | default(true) %}
    graceful-restart
  {% endif %}
  {% if switch_item.bgp.graceful_restart_helper is defined and switch_item.bgp.graceful_restart_helper %}
    graceful-restart-helper
  {% elif switch_item.bgp.graceful_restart_helper is not defined and item.bgp.graceful_restart_helper is defined and item.bgp.graceful_restart_helper %}
    graceful-restart-helper
  {% endif %}
  {% if switch_item.bgp.local_as is defined and switch_item.bgp.local_as %}
    local-as {{ switch_item.bgp.local_as }}
  {% elif item.bgp.local_as is defined and item.bgp.local_as %}
    local-as {{ item.bgp.local_as }}
  {% endif %}
  {% if switch_item.bgp.address_family_ipv4_unicast is defined and switch_item.bgp.address_family_ipv4_unicast %}
    address-family ipv4 unicast
    {% if switch_item.bgp.address_family_ipv4_unicast.ebgp_distance and switch_item.bgp.address_family_ipv4_unicast.ibgp_distance and switch_item.bgp.address_family_ipv4_unicast.local_distance %}
      distance {{ switch_item.bgp.address_family_ipv4_unicast.ebgp_distance }} {{ switch_item.bgp.address_family_ipv4_unicast.ibgp_distance }} {{ switch_item.bgp.address_family_ipv4_unicast.local_distance }}
    {% endif %}
    {% if switch_item.bgp.address_family_ipv4_unicast.default_originate is defined and switch_item.bgp.address_family_ipv4_unicast.default_originate %}
      default-information originate
    {% endif %}
    {% if switch_item.bgp.address_family_ipv4_unicast.additional_paths_send is defined and switch_item.bgp.address_family_ipv4_unicast.additional_paths_send %}
      additional-paths send
    {% endif %}
    {% if switch_item.bgp.address_family_ipv4_unicast.additional_paths_receive is defined and switch_item.bgp.address_family_ipv4_unicast.additional_paths_receive %}
      additional-paths receive
    {% endif %}
    {% if switch_item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map is defined and switch_item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map %}
      additional-paths selection route-map {{ switch_item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map }}
    {% endif %}
  {% elif item.bgp.address_family_ipv4_unicast is defined and item.bgp.address_family_ipv4_unicast %}
    address-family ipv4 unicast
    {% if item.bgp.address_family_ipv4_unicast.ebgp_distance and item.bgp.address_family_ipv4_unicast.ibgp_distance and item.bgp.address_family_ipv4_unicast.local_distance %}
      distance {{ item.bgp.address_family_ipv4_unicast.ebgp_distance }} {{ item.bgp.address_family_ipv4_unicast.ibgp_distance }} {{ item.bgp.address_family_ipv4_unicast.local_distance }}
    {% endif %}
    {% if item.bgp.address_family_ipv4_unicast.default_originate is defined and item.bgp.address_family_ipv4_unicast.default_originate %}
      default-information originate
    {% endif %}
    {% if item.bgp.address_family_ipv4_unicast.additional_paths_send is defined and item.bgp.address_family_ipv4_unicast.additional_paths_send %}
      additional-paths send
    {% endif %}
    {% if item.bgp.address_family_ipv4_unicast.additional_paths_receive is defined and item.bgp.address_family_ipv4_unicast.additional_paths_receive %}
      additional-paths receive
    {% endif %}
    {% if item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map is defined and item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map %}
      additional-paths selection route-map {{ item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map }}
    {% endif %}
  {% endif %}
  {% if switch_item.bgp.address_family_ipv6_unicast is defined and switch_item.bgp.address_family_ipv6_unicast %}
    address-family ipv6 unicast
    {% if switch_item.bgp.address_family_ipv6_unicast.ebgp_distance and switch_item.bgp.address_family_ipv6_unicast.ibgp_distance and switch_item.bgp.address_family_ipv6_unicast.local_distance %}
      distance {{ switch_item.bgp.address_family_ipv6_unicast.ebgp_distance }} {{ switch_item.bgp.address_family_ipv6_unicast.ibgp_distance }} {{ switch_item.bgp.address_family_ipv6_unicast.local_distance }}
    {% endif %}
    {% if switch_item.bgp.address_family_ipv6_unicast.default_originate is defined and switch_item.bgp.address_family_ipv6_unicast.default_originate %}
      default-information originate
    {% endif %}
    {% if switch_item.bgp.address_family_ipv6_unicast.additional_paths_send is defined and switch_item.bgp.address_family_ipv6_unicast.additional_paths_send %}
      additional-paths send
    {% endif %}
    {% if switch_item.bgp.address_family_ipv6_unicast.additional_paths_receive is defined and switch_item.bgp.address_family_ipv6_unicast.additional_paths_receive %}
      additional-paths receive
    {% endif %}
    {% if switch_item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map is defined and switch_item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map %}
      additional-paths selection route-map {{ switch_item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map }}
    {% endif %}
  {% elif item.bgp.address_family_ipv6_unicast is defined and item.bgp.address_family_ipv6_unicast %}
    address-family ipv6 unicast
    {% if item.bgp.address_family_ipv6_unicast.ebgp_distance and item.bgp.address_family_ipv6_unicast.ibgp_distance and item.bgp.address_family_ipv6_unicast.local_distance %}
      distance {{ item.bgp.address_family_ipv6_unicast.ebgp_distance }} {{ item.bgp.address_family_ipv6_unicast.ibgp_distance }} {{ item.bgp.address_family_ipv6_unicast.local_distance }}
    {% endif %}
    {% if item.bgp.address_family_ipv6_unicast.default_originate is defined and item.bgp.address_family_ipv6_unicast.default_originate %}
      default-information originate
    {% endif %}
    {% if item.bgp.address_family_ipv6_unicast.additional_paths_send is defined and item.bgp.address_family_ipv6_unicast.additional_paths_send %}
      additional-paths send
    {% endif %}
    {% if item.bgp.address_family_ipv6_unicast.additional_paths_receive is defined and item.bgp.address_family_ipv6_unicast.additional_paths_receive %}
      additional-paths receive
    {% endif %}
    {% if item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map is defined and item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map %}
      additional-paths selection route-map {{ item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map }}
    {% endif %}
  {% endif %}
  {% if switch_item.bgp_peers is defined and switch_item.bgp_peers %}
  {% for peer in switch_item.bgp_peers %}
    neighbor {{ peer.address }}
      remote-as {{ peer.remote_as }}
    {% if peer.local_as is defined and peer.local_as %}
      local-as {{ peer.local_as }}
    {% endif %}
    {% if peer.description is defined %}
      description {{ peer.description }}
    {% endif %}
    {% if peer.update_source is defined and peer.update_source %}
      update-source {{ peer.update_source }}
    {% elif switch_item.loopback_id is defined and switch_item.loopback_id %}
      update-source Loopback{{ switch_item.loopback_id }}
    {% endif %}
    {% if peer.disable_connected_check is defined and peer.disable_connected_check %}
      disable-connected-check
    {% endif %}
    {% if peer.remove_private_as is defined and peer.remove_private_as %}
      remove-private-as
    {% endif %}
      ebgp-multihop {{ peer.ebgp_multihop | default(1) }}
    {% if peer.password is defined %}
      password 3 {{ peer.password }}
    {% endif %}
    {% if peer.address_family_ipv4_unicast is defined %}
      address-family ipv4 unicast
      {% if peer.address_family_ipv4_unicast.route_map_in is defined %}
        route-map {{ peer.address_family_ipv4_unicast.route_map_in }} in
      {% endif %}
      {% if peer.address_family_ipv4_unicast.route_map_out is defined %}
        route-map {{ peer.address_family_ipv4_unicast.route_map_out }} out
      {% endif %}
      {% if peer.address_family_ipv4_unicast.weight is defined and peer.address_family_ipv4_unicast.weight %}
        weight {{ peer.address_family_ipv4_unicast.weight }}
      {% endif %}
      {% if peer.address_family_ipv4_unicast.allow_as_in_max is defined and peer.address_family_ipv4_unicast.allow_as_in_max %}
        allowas-in {{ peer.address_family_ipv4_unicast.allow_as_in_max }}
      {% endif %}
      {% if peer.address_family_ipv4_unicast.send_community is defined and peer.address_family_ipv4_unicast.send_community %}
        send-community
      {% endif %}
      {% if peer.address_family_ipv4_unicast.send_ext_community is defined and peer.address_family_ipv4_unicast.send_ext_community %}
        send-community extended
      {% endif %}
      {% if peer.address_family_ipv4_unicast.as_override is defined and peer.address_family_ipv4_unicast.as_override %}
        as-override
      {% endif %}
      {% if peer.address_family_ipv4_unicast.next_hop_self is defined and peer.address_family_ipv4_unicast.next_hop_self %}
        next-hop-self
      {% endif %}
      {% if peer.address_family_ipv4_unicast.default_originate is defined and peer.address_family_ipv4_unicast.default_originate %}
        default-originate
      {% endif %}
      {% if peer.address_family_ipv4_unicast.route_reflector_client is defined and peer.address_family_ipv4_unicast.route_reflector_client %}
        route-reflector-client
      {% endif %}
    {% endif %}
    {% if peer.address_family_ipv6_unicast is defined %}
      address-family ipv6 unicast
      {% if peer.address_family_ipv6_unicast.route_map_in is defined %}
        route-map {{ peer.address_family_ipv6_unicast.route_map_in }} in
      {% endif %}
      {% if peer.address_family_ipv6_unicast.route_map_out is defined %}
        route-map {{ peer.address_family_ipv6_unicast.route_map_out }} out
      {% endif %}
      {% if peer.address_family_ipv6_unicast.weight is defined and peer.address_family_ipv6_unicast.weight %}
        weight {{ peer.address_family_ipv6_unicast.weight }}
      {% endif %}
      {% if peer.address_family_ipv6_unicast.allow_as_in_max is defined and peer.address_family_ipv6_unicast.allow_as_in_max %}
        allowas-in {{ peer.address_family_ipv6_unicast.allow_as_in_max }}
      {% endif %}
      {% if peer.address_family_ipv6_unicast.send_community is defined and peer.address_family_ipv6_unicast.send_community %}
        send-community
      {% endif %}
      {% if peer.address_family_ipv6_unicast.send_ext_community is defined and peer.address_family_ipv6_unicast.send_ext_community %}
        send-community extended
      {% endif %}
      {% if peer.address_family_ipv6_unicast.as_override is defined and peer.address_family_ipv6_unicast.as_override %}
        as-override
      {% endif %}
      {% if peer.address_family_ipv6_unicast.next_hop_self is defined and peer.address_family_ipv6_unicast.next_hop_self %}
        next-hop-self
      {% endif %}
      {% if peer.address_family_ipv6_unicast.default_originate is defined and peer.address_family_ipv6_unicast.default_originate %}
        default-originate
      {% endif %}
      {% if peer.address_family_ipv6_unicast.route_reflector_client is defined and peer.address_family_ipv6_unicast.route_reflector_client %}
        route-reflector-client
      {% endif %}
    {% endif %}
  {% endfor %}
  {% endif %}
!