! This NDFC VRF-Lite eBGP config data structure is auto-generated
! DO NOT EDIT MANUALLY
!
!
{% if switch_item.bgp_peers %}
  {% for peer in switch_item.bgp_peers %}
    {% if peer.bfd.enabled %}
feature bfd
    {% endif %}
  {% endfor %}
!
{% endif %}
vrf context {{ item.vrf }}
{% if switch_item.static_routes %}
  {% for static_route in switch_item.static_routes %}
    {% for next_hop in static_route.next_hops %}
      {% if static_route.route_tag %}
  ip route {{ static_route.prefix }} {{ next_hop.ip }} tag {{ static_route.route_tag }}
      {% else %}
  ip route {{ static_route.prefix }} {{ next_hop.ip }}
      {% endif %}
    {% endfor %}
  {% endfor %}
!
{% endif %}
router bgp {{ MD_Extended.vxlan.global.bgp_asn }}
  vrf {{ item.vrf }}
  {% if switch_item.router_id %}
    router-id {{ switch_item.router_id }}
  {% endif %}
  {% if switch_item.bgp.best_path_as_path_relax %}
    bestpath as-path multipath-relax
  {% elif switch_item.bgp.best_path_as_path_relax is not defined and item.bgp.best_path_as_path_relax %}
    bestpath as-path multipath-relax
  {% endif %}
  {% if switch_item.bgp.graceful_restart %}
    graceful-restart
  {% elif switch_item.bgp.graceful_restart is not defined and item.bgp.graceful_restart %}
    graceful-restart
  {% elif item.bgp.graceful_restart is not defined and defaults.vxlan.overlay_extensions.vrf_lites.bgp.graceful_restart %}
    graceful-restart
  {% endif %}
  {% if switch_item.bgp.graceful_restart_helper %}
    graceful-restart-helper
  {% elif switch_item.bgp.graceful_restart_helper is not defined and item.bgp.graceful_restart_helper %}
    graceful-restart-helper
  {% endif %}
  {% if switch_item.bgp.local_as %}
    local-as {{ switch_item.bgp.local_as }}
  {% elif item.bgp.local_as %}
    local-as {{ item.bgp.local_as }}
  {% endif %}
  {% if switch_item.bgp.address_family_ipv4_unicast %}
    address-family ipv4 unicast
  {#
    {% if switch_item.bgp.address_family_ipv4_unicast.ebgp_distance | switch_item.bgp.address_family_ipv4_unicast.ibgp_distance | switch_item.bgp.address_family_ipv4_unicast.local_distance %}
      distance {{ switch_item.bgp.address_family_ipv4_unicast.ebgp_distance  }} {{ switch_item.bgp.address_family_ipv4_unicast.ibgp_distance }} {{ switch_item.bgp.address_family_ipv4_unicast.local_distance }}
    {% endif %}
  #}
    {% if switch_item.bgp.address_family_ipv4_unicast.default_originate %}
      default-information originate
    {% endif %}
    {% if switch_item.bgp.address_family_ipv4_unicast.additional_paths_send %}
      additional-paths send
    {% endif %}
    {% if switch_item.bgp.address_family_ipv4_unicast.additional_paths_receive %}
      additional-paths receive
    {% endif %}
    {% if switch_item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map %}
      additional-paths selection route-map {{ switch_item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map }}
    {% endif %}
    {% if switch_item.redistribution %}
      {% for switch_redist in switch_item.redistribution %}
        {% if switch_redist.source == 'direct' and switch_redist.route_map %}
      redistribute direct route-map {{ switch_redist.route_map }}
        {% endif %}
        {% if switch_redist.source == 'static' and switch_redist.route_map %}
      redistribute static route-map {{ switch_redist.route_map }}
        {% endif %}
      {% endfor %}
!
    {% endif %}
  {% elif item.bgp.address_family_ipv4_unicast %}
    address-family ipv4 unicast
    {#
      distance {{ (item.bgp.address_family_ipv4_unicast.ebgp_distance | defaults.vxlan.overlay_extensions.vrf_lites.bgp.address_family_ipv4_unicast.ebgp_distance) }} {{ (item.bgp.address_family_ipv4_unicast.ibgp_distance | defaults.vxlan.overlay_extensions.vrf_lites.bgp.address_family_ipv4_unicast.ibgp_distance) }} {{ (item.bgp.address_family_ipv4_unicast.local_distance | defaults.vxlan.overlay_extensions.vrf_lites.bgp.address_family_ipv4_unicast.local_distance) }}
    #}
    {% if item.bgp.address_family_ipv4_unicast.default_originate %}
      default-information originate
    {% endif %}
    {% if item.bgp.address_family_ipv4_unicast.additional_paths_send %}
      additional-paths send
    {% endif %}
    {% if item.bgp.address_family_ipv4_unicast.additional_paths_receive %}
      additional-paths receive
    {% endif %}
    {% if item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map %}
      additional-paths selection route-map {{ item.bgp.address_family_ipv4_unicast.additional_paths_selection_route_map }}
    {% endif %}
!
  {% endif %}
  {% if switch_item.bgp.address_family_ipv6_unicast %}
    address-family ipv6 unicast
    {#
    {% if switch_item.bgp.address_family_ipv6_unicast.ebgp_distance and switch_item.bgp.address_family_ipv6_unicast.ibgp_distance and switch_item.bgp.address_family_ipv6_unicast.local_distance %}
      distance {{ switch_item.bgp.address_family_ipv6_unicast.ebgp_distance }} {{ switch_item.bgp.address_family_ipv6_unicast.ibgp_distance }} {{ switch_item.bgp.address_family_ipv6_unicast.local_distance }}
    {% endif %}
    #}
    {% if switch_item.bgp.address_family_ipv6_unicast.default_originate %}
      default-information originate
    {% endif %}
    {% if switch_item.bgp.address_family_ipv6_unicast.additional_paths_send %}
      additional-paths send
    {% endif %}
    {% if switch_item.bgp.address_family_ipv6_unicast.additional_paths_receive %}
      additional-paths receive
    {% endif %}
    {% if switch_item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map %}
      additional-paths selection route-map {{ switch_item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map }}
    {% endif %}
    {% if switch_item.redistribution %}
      {% for switch_redist in switch_item.redistribution %}
        {% if switch_redist.source == 'static' and switch_redist.route_map %}
      redistribute static route-map {{ switch_redist.route_map }}
        {% endif %}
      {% endfor %}
!
    {% endif %}
  {% elif item.bgp.address_family_ipv6_unicast %}
    address-family ipv6 unicast
    {#
      distance {{ item.bgp.address_family_ipv6_unicast.ebgp_distance | default(defaults.vxlan.overlay_extensions.vrf_lites.bgp.address_family_ipv6_unicast.ebgp_distance) }} {{ item.bgp.address_family_ipv6_unicast.ibgp_distance | default(defaults.vxlan.overlay_extensions.vrf_lites.bgp.address_family_ipv6_unicast.ibgp_distance) }} {{ item.bgp.address_family_ipv6_unicast.local_distance | default(defaults.vxlan.overlay_extensions.vrf_lites.bgp.address_family_ipv6_unicast.local_distance) }}
    #}
    {% if item.bgp.address_family_ipv6_unicast.default_originate %}
      default-information originate
    {% endif %}
    {% if item.bgp.address_family_ipv6_unicast.additional_paths_send %}
      additional-paths send
    {% endif %}
    {% if item.bgp.address_family_ipv6_unicast.additional_paths_receive %}
      additional-paths receive
    {% endif %}
    {% if item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map %}
      additional-paths selection route-map {{ item.bgp.address_family_ipv6_unicast.additional_paths_selection_route_map }}
    {% endif %}
!
  {% endif %}
{% if switch_item.bgp_peers %}
  {% for peer in switch_item.bgp_peers %}
    neighbor {{ peer.address }}
      remote-as {{ peer.remote_as }}
    {% if peer.local_as %}
      local-as {{ peer.local_as }} no-prepend replace-as
    {% endif %}
    {% if peer.description %}
      description {{ peer.description }}
    {% endif %}
    {% if peer.update_source %}
      update-source {{ peer.update_source }}
    {% elif switch_item.loopback_id %}
      update-source Loopback{{ switch_item.loopback_id }}
    {% endif %}
    {% if peer.disable_connected_check %}
      disable-connected-check
    {% endif %}
    {% if peer.remove_private_as_all %}
      remove-private-as all
    {% elif peer.remove_private_as %}
      remove-private-as
    {% endif %}
      ebgp-multihop {{ peer.ebgp_multihop | default(defaults.vxlan.overlay_extensions.vrf_lites.switches.bgp_peers.ebgp_multihop) }}
    {% if peer.password is defined %}
      password 3 {{ peer.password }}
    {% endif %}
    {% if peer.address_family_ipv4_unicast %}
      address-family ipv4 unicast
      {% if peer.address_family_ipv4_unicast.route_map_in %}
        route-map {{ peer.address_family_ipv4_unicast.route_map_in }} in
      {% endif %}
      {% if peer.address_family_ipv4_unicast.route_map_out %}
        route-map {{ peer.address_family_ipv4_unicast.route_map_out }} out
      {% endif %}
      {% if peer.address_family_ipv4_unicast.weight %}
        weight {{ peer.address_family_ipv4_unicast.weight }}
      {% endif %}
      {% if peer.address_family_ipv4_unicast.allow_as_in_number %}
        allowas-in {{ peer.address_family_ipv4_unicast.allow_as_in_number }}
      {% elif peer.address_family_ipv4_unicast.allow_as_in %}
        allowas-in 
      {% endif %}
      {% if peer.address_family_ipv4_unicast.send_community %}
        send-community
      {% elif peer.address_family_ipv4_unicast.send_community is not defined and default(defauts.vxlan.overlay_extensions.vrf_lites.switches.bgp_peers.address_family_ipv4_unicast.send_community is true) %}
        send-community
      {% endif %}
      {% if peer.address_family_ipv4_unicast.send_ext_community %}
        send-community extended
      {% elif peer.address_family_ipv4_unicast.send_ext_community is not defined and default(defauts.vxlan.overlay_extensions.vrf_lites.switches.bgp_peers.address_family_ipv4_unicast.send_ext_community is true) %}
        send-community extended
      {% endif %}
      {% if peer.address_family_ipv4_unicast.as_override %}
        as-override
      {% endif %}
      {% if peer.address_family_ipv4_unicast.next_hop_self %}
        next-hop-self
      {% endif %}
      {% if peer.address_family_ipv4_unicast.default_originate %}
        default-originate
      {% endif %}
!
    {% endif %}
    {% if peer.address_family_ipv6_unicast %}
      address-family ipv6 unicast
      {% if peer.address_family_ipv6_unicast.route_map_in %}
        route-map {{ peer.address_family_ipv6_unicast.route_map_in }} in
      {% endif %}
      {% if peer.address_family_ipv6_unicast.route_map_out %}
        route-map {{ peer.address_family_ipv6_unicast.route_map_out }} out
      {% endif %}
      {% if peer.address_family_ipv6_unicast.weight %}
        weight {{ peer.address_family_ipv6_unicast.weight }}
      {% endif %}
      {% if peer.address_family_ipv6_unicast.allow_as_in_number %}
        allowas-in {{ peer.address_family_ipv6_unicast.allow_as_in_number }}
      {% elif peer.address_family_ipv6_unicast.allow_as_in %}
        allowas-in
      {% endif %}
      {% if peer.address_family_ipv6_unicast.send_community %}
        send-community
      {% elif peer.address_family_ipv6_unicast.send_community is not defined and default(defauts.vxlan.overlay_extensions.vrf_lites.switches.bgp_peers.address_family_ipv6_unicast.send_community is true) %}
        send-community
      {% endif %}
      {% if peer.address_family_ipv6_unicast.send_ext_community %}
        send-community extended
      {% elif peer.address_family_ipv6_unicast.send_ext_community is not defined and default(defauts.vxlan.overlay_extensions.vrf_lites.switches.bgp_peers.address_family_ipv6_unicast.send_ext_community is true) %}
        send-community extended
      {% endif %}
      {% if peer.address_family_ipv6_unicast.as_override %}
        as-override
      {% endif %}
      {% if peer.address_family_ipv6_unicast.next_hop_self %}
        next-hop-self
      {% endif %}
      {% if peer.address_family_ipv6_unicast.default_originate %}
        default-originate
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}