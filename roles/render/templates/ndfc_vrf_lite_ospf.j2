! This NDFC VRF-Lite BGP config data structure is auto-generated
! DO NOT EDIT MANUALLY
!
!
vrf context {{ item.vrf }}
  address-family ipv4 unicast
    route-target both auto
    route-target both auto evpn
!
{% set bgp1 = namespace(route_map='') %}
{% set ospf1 = namespace(route_map='') %}
{% if item.redistribution is defined and item.redistribution %}
{% for redist in item.redistribution %}
{% if redist.source is defined and redist.source == 'bgp' %}
{% if redist.route_map is defined and redist.route_map %}
{% set bgp1.route_map = redist.route_map %}
{% endif %}
{% endif %}
{% if redist.source is defined and redist.source == 'ospf' %}
{% if redist.route_map is defined and redist.route_map %}
{% set ospf1.route_map = redist.route_map %}
{% endif %}
{% endif %}
{% endfor %}
{% endif %}
{% if switch_item.redistribution is defined and switch_item.redistribution %}
{% for switch_redist in switch_item.redistribution %}
{% if switch_redist.source is defined and switch_redist.source == 'bgp' %}
{% if switch_redist.route_map is defined and switch_redist.route_map %}
{% set bgp1.route_map = switch_redist.route_map %}
{% endif %}
{% endif %}
{% if switch_redist.source is defined and switch_redist.source == 'ospf' %}
{% if switch_redist.route_map is defined and switch_redist.route_map %}
{% set ospf1.route_map = switch_redist.route_map %}
{% endif %}
{% endif %}
{% endfor %}
{% endif %}
{% if bgp1.route_map != '' %}
route-map {{ bgp1.route_map }} permit 10
  match route-type internal
!
router ospf {{item.ospf['process']}}
  vrf {{ item.vrf }}
    redistribute bgp {{ MD_Extended.vxlan.global.bgp_asn }} route-map {{ bgp1.route_map }}
!
{% endif %}
{% if ospf1.route_map != '' %}
route-map {{ ospf1.route_map }} permit 10
!
router bgp {{ MD_Extended.vxlan.global.bgp_asn }}
  vrf {{ item.vrf }}
    address-family ipv4 unicast
      redistribute ospf {{item.ospf['process']}} route-map {{ ospf1.route_map }}
!
{% endif %}
{% if switch_item.interfaces is defined and switch_item.interfaces %}
{% for interface in switch_item.interfaces %}
interface {{ interface['name'] }}
  ip ospf network {{ interface.ospf['network_type'] }}   
  ip router ospf {{item.ospf['process']}} area {{interface.ospf['area']}}
!
{% endfor %}
{% endif %}